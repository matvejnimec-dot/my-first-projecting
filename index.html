<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Хрестики-нулики — в одному файлі</title>
<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --accent:#60a5fa; --xcol:#16a34a; --ocol:#ef4444;
    --muted:#94a3b8;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:
    radial-gradient(800px 400px at 10% 10%, rgba(96,165,250,0.03), transparent 8%),
    var(--bg); color:#e6eef8; padding:24px;
  }

  .wrap{
    width:100%; max-width:760px; display:grid; grid-template-columns: 1fr 260px; gap:18px;
    align-items:start;
  }

  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    padding:14px; border-radius:12px; box-shadow: 0 10px 30px rgba(2,6,12,0.6);
  }

  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  h1{margin:0;font-size:18px}
  .info{color:var(--muted);font-size:13px}

  /* board */
  .board{
    width:360px; height:360px; display:grid; grid-template-columns: repeat(3,1fr);
    gap:10px; background:linear-gradient(180deg,#071022,#071428); padding:10px; border-radius:12px;
  }
  .cell{
    background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
    display:grid; place-items:center; font-size:72px; font-weight:800; user-select:none;
    border-radius:10px; cursor:pointer; transition:transform .12s ease, background .12s ease;
    -webkit-tap-highlight-color: transparent;
  }
  .cell:active{ transform:scale(.98) }
  .cell.empty:hover{ box-shadow: inset 0 1px 0 rgba(255,255,255,0.02), 0 6px 16px rgba(2,6,12,0.4) }

  .x { color: var(--xcol); text-shadow: 0 6px 18px rgba(22,163,74,0.08) }
  .o { color: var(--ocol); text-shadow: 0 6px 18px rgba(239,68,68,0.08) }

  /* right column */
  .right{display:flex;flex-direction:column;gap:12px}
  .controls{display:flex;flex-wrap:wrap;gap:8px}
  button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent);padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:700}
  button.secondary{color:var(--muted)}
  .small{padding:6px 8px;font-size:13px}

  .status{font-weight:700;font-size:16px}
  .scoreboard{display:flex;gap:8px;align-items:center;justify-content:space-between}
  .score-item{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;min-width:70px;text-align:center}
  .muted{color:var(--muted);font-size:13px}

  @media (max-width:880px){
    .wrap{grid-template-columns:1fr; padding-bottom:40px}
    .board{width:100%;height:320px}
  }
</style>
</head>
<body>
  <div class="wrap" role="application" aria-label="Хрестики-нулики">
    <div class="panel">
      <header>
        <h1>Хрестики-нулики</h1>
        <div class="info">Гра — в один файл • клавіші: 1-9 або кліком</div>
      </header>

      <div id="board" class="board" aria-label="Ігрове поле" role="grid">
        <!-- cells generated by JS -->
      </div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
        <div class="status" id="status">Хід: X</div>
        <div style="display:flex;gap:8px">
          <button id="newBtn">Нова гра</button>
          <button id="modeBtn" class="secondary small">Грати: Людина ⟷ Людина</button>
        </div>
      </div>
    </div>

    <div class="right">
      <div class="panel">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <div class="muted">Рахунок (збережено)</div>
          <div class="muted">Режим</div>
        </div>

        <div class="scoreboard" style="margin-bottom:10px">
          <div class="score-item"><div class="muted">X</div><div id="scoreX" style="font-weight:800">0</div></div>
          <div class="score-item"><div class="muted">Нічиї</div><div id="scoreD" style="font-weight:800">0</div></div>
          <div class="score-item"><div class="muted">O</div><div id="scoreO" style="font-weight:800">0</div></div>
        </div>

        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="resetScores" class="secondary small">Очистити рекорд</button>
          <label style="display:flex;align-items:center;gap:6px;margin-left:auto" class="muted">
            <input id="computerStarts" type="checkbox" /> Комп'ютер починає
          </label>
        </div>
      </div>

      <div class="panel">
        <div class="muted" style="margin-bottom:8px">Поради</div>
        <ul style="margin:0 0 0 18px;padding:0;color:var(--muted)">
          <li>Клавіші 1–9 відповідають клітинкам (зліва направо, зверху вниз).</li>
          <li>В режимі проти комп’ютера AI грає оптимально (мінімакс).</li>
        </ul>
      </div>

      <div class="panel">
        <div class="muted">Версія</div>
        <div style="font-weight:700;margin-top:6px">Однофайлова • JS AI</div>
      </div>
    </div>
  </div>

<script>
(() => {
  // State
  const boardEl = document.getElementById('board');
  const statusEl = document.getElementById('status');
  const modeBtn = document.getElementById('modeBtn');
  const newBtn = document.getElementById('newBtn');
  const scoreXEl = document.getElementById('scoreX');
  const scoreOEl = document.getElementById('scoreO');
  const scoreDEl = document.getElementById('scoreD');
  const resetScoresBtn = document.getElementById('resetScores');
  const computerStartsChk = document.getElementById('computerStarts');

  let cells = [];               // DOM cells
  let board = Array(9).fill(null); // null | 'X' | 'O'
  let current = 'X';
  let playing = true;
  let mode = 'pvp'; // 'pvp' or 'pvc'
  let scores = { X:0, O:0, D:0 }; // stored in localStorage

  // init scores from localStorage
  try {
    const s = JSON.parse(localStorage.getItem('ttt_scores') || '{}');
    if (s && typeof s === 'object') scores = Object.assign(scores, s);
  } catch(e){/*ignore*/}
  updateScoreUI();

  // create 9 cells
  function createBoard(){
    boardEl.innerHTML = '';
    cells = [];
    for (let i=0;i<9;i++){
      const cell = document.createElement('button');
      cell.className = 'cell empty';
      cell.setAttribute('data-index', i);
      cell.setAttribute('role','gridcell');
      cell.setAttribute('aria-label', 'Клітинка ' + (i+1));
      cell.style.fontFamily = 'system-ui, Arial';
      cell.addEventListener('click', onCellClick);
      // keyboard: allow number keys focus
      cell.addEventListener('keydown', (e)=>{
        if (e.key >= '1' && e.key <= '9') {
          const idx = Number(e.key) - 1;
          if (idx >=0 && idx <9) cells[idx].click();
        }
      });
      boardEl.appendChild(cell);
      cells.push(cell);
    }
  }

  function onCellClick(e){
    const idx = Number(e.currentTarget.dataset.index);
    if (!playing || board[idx]) return;
    makeMove(idx, current);
  }

  // make a move at index by player
  function makeMove(idx, player){
    if (board[idx] || !playing) return;
    board[idx] = player;
    renderCell(idx);
    const winner = checkWinner(board);
    if (winner) {
      playing = false;
      if (winner === 'D') {
        statusEl.textContent = 'Нічия';
        scores.D += 1;
      } else {
        statusEl.textContent = 'Переможець: ' + winner;
        scores[winner] += 1;
      }
      saveScores();
      updateScoreUI();
      highlightWinningLine(board, winner);
      return;
    }
    // switch
    current = player === 'X' ? 'O' : 'X';
    statusEl.textContent = 'Хід: ' + current;
    // if vs computer and it's O's (or whichever AI) turn, run AI
    if (mode === 'pvc') {
      // choose which side AI plays: we'll let human always be X, AI = O
      const aiPlays = 'O';
      if (current === aiPlays) {
        // small delay for UX
        setTimeout(() => {
          const move = computeBestMove(board, aiPlays);
          makeMove(move, aiPlays);
        }, 200);
      }
    }
  }

  // render a cell
  function renderCell(i){
    const val = board[i];
    const el = cells[i];
    el.classList.remove('empty');
    if (!val) { el.textContent = ''; el.classList.add('empty'); return; }
    el.textContent = val;
    el.classList.toggle('x', val === 'X');
    el.classList.toggle('o', val === 'O');
  }

  function renderAll(){
    for (let i=0;i<9;i++) renderCell(i);
  }

  // check winner or draw
  function checkWinner(b){
    const lines = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];
    for (const [a,b1,c] of lines){
      if (board[a] && board[a] === board[b1] && board[a] === board[c]) {
        return board[a]; // 'X' or 'O'
      }
    }
    if (board.every(cell => cell)) return 'D'; // draw
    return null;
  }

  // highlight winning line
  function highlightWinningLine(b, winner){
    if (winner !== 'X' && winner !== 'O') return;
    const lines = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];
    for (const [a,b1,c] of lines){
      if (board[a] && board[a] === board[b1] && board[a] === board[c]) {
        [a,b1,c].forEach(i => {
          cells[i].style.boxShadow = '0 10px 30px rgba(0,0,0,0.6), 0 6px 20px rgba(96,165,250,0.12)';
          cells[i].style.transform = 'scale(1.04)';
        });
        break;
      }
    }
  }

  // restart game
  function newGame(){
    board = Array(9).fill(null);
    current = 'X';
    playing = true;
    statusEl.textContent = 'Хід: ' + current;
    // clear cell styles
    cells.forEach(c => { c.style.boxShadow=''; c.style.transform=''; });
    renderAll();
    // if vs computer and computerStarts checked, let AI move first
    if (mode === 'pvc' && computerStartsChk.checked) {
      // AI = 'O' by default, if computer starts we let it place O after a little delay
      current = 'O';
      statusEl.textContent = 'Хід: ' + current;
      setTimeout(()=> {
        const mv = computeBestMove(board, 'O');
        makeMove(mv, 'O');
      }, 250);
    }
  }

  // score handling
  function saveScores(){
    try {
      localStorage.setItem('ttt_scores', JSON.stringify(scores));
    } catch(e){}
  }
  function updateScoreUI(){
    scoreXEl.textContent = scores.X;
    scoreOEl.textContent = scores.O;
    scoreDEl.textContent = scores.D;
  }

  resetScoresBtn.addEventListener('click', ()=>{
    scores = {X:0,O:0,D:0};
    saveScores();
    updateScoreUI();
  });

  // mode toggle
  modeBtn.addEventListener('click', ()=>{
    mode = (mode === 'pvp') ? 'pvc' : 'pvp';
    modeBtn.textContent = mode === 'pvp' ? 'Грати: Людина ⟷ Людина' : 'Грати: Людина ⟷ Компʼютер';
    newGame();
  });

  newBtn.addEventListener('click', ()=> newGame());

  // keyboard mapping 1..9
  window.addEventListener('keydown', (e)=>{
    if (!playing) {
      // allow Enter to start a new game
      if (e.key === 'Enter') newGame();
      return;
    }
    if (e.key >= '1' && e.key <= '9') {
      const idx = Number(e.key) - 1;
      // Mapping: 1..9 left->right top->bottom; that matches our index 0..8
      if (!board[idx]) makeMove(idx, current);
    }
  });

  // --- Minimax AI for Tic-Tac-Toe ---
  // AI plays as 'O' (when mode === 'pvc'). Human as 'X'.
  function computeBestMove(b, player) {
    // if board empty, take center
    if (b.every(v => v === null)) return 4;
    const opponent = player === 'X' ? 'O' : 'X';

    function winner(bd) {
      const lines = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ];
      for (const [a,b1,c] of lines){
        if (bd[a] && bd[a] === bd[b1] && bd[a] === bd[c]) return bd[a];
      }
      if (bd.every(cell => cell)) return 'D';
      return null;
    }

    function minimax(bd, turn) {
      const win = winner(bd);
      if (win === player) return {score:  10};
      if (win === opponent) return {score: -10};
      if (win === 'D') return {score: 0};

      const moves = [];
      for (let i=0;i<9;i++){
        if (!bd[i]) {
          bd[i] = turn;
          const result = minimax(bd, turn === 'X' ? 'O' : 'X');
          moves.push({index: i, score: result.score});
          bd[i] = null;
        }
      }

      // choose best move depending on whose turn in top-level call
      if (turn === player) {
        // maximize
        let best = moves[0];
        for (const m of moves) if (m.score > best.score) best = m;
        return best;
      } else {
        // minimize
        let best = moves[0];
        for (const m of moves) if (m.score < best.score) best = m;
        return best;
      }
    }

    const bestMove = minimax(b.slice(), player);
    return bestMove.index;
  }

  // Initialize UI
  createBoard();
  newGame();
  // set initial mode text
  modeBtn.textContent = mode === 'pvp' ? 'Грати: Людина ⟷ Людина' : 'Грати: Людина ⟷ Компʼютер';

  // expose for debugging (optional)
  window.__ttt = { board, newGame, makeMove, computeBestMove };
})();
</script>
</body>
</html>
